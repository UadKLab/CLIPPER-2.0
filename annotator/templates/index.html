<!DOCTYPE html>

<head>
	
	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@300&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="../static/index.css">

</head>

<body>
	
	<img id="logo" alt="DTU logo" src="../static/DTU_logo.png">
	<hr/>
	
	<h1 id="center">Peptide annotator</h1>
	<p id="center">
		N-term annotator is a bioinformatics tool built in Python. It queries publicly available databases such as Uniprot and MEROPS and annotates peptide hits generated by mass spectrometry experiments. To that end, it utilizes <a href="https://biopython.org/">Biopython</a>, <a href="https://pandas.pydata.org/">Pandas</a> and other popular packages from the python library. It can also be incorporated in PD searches as a scripting node for seamless integration. The script and instructions can be found <a href="{{url_for('coming')}}">here</a>. Install in python with PyPI from <a href="{{url_for('coming')}}">here</a>. Source code for this app is available <a href="{{url_for('coming')}}">here</a>. Please cite <a href="{{url_for('coming')}}">our paper</a> if you are using this tool for your analysis.
	</p>
	
	<hr/>

	<form method=post enctype=multipart/form-data>
		
		<h2 id="center">Submission settings</h2>
		<p>
		Required fields are indicated by *. If an email was provided, the results will be emailed to you after job completion. Keep in mind processing can take up to a few hours for an input file with tens of thousands of rows.
		<b>Input file must be either peptide groups table from PD or peptide quant pivot table from SM.</b>
		</p>

		<section>
		
		<h3>Input</h3>

			<fieldset>
				<legend>Input file*</legend>
					<input type=file name=infile required>
			</fieldset>
			
			<fieldset>
				<legend>Input format</legend>

				<label for="infile_type1">
					<input type="radio" id="infile_type1" name="infile_type" value="csv" required>
					Csv
				</label>

				<label for="infile_type2">
					<input type="radio" id="infile_type2" name="infile_type" value="excel" >
					Excel
				</label>

				<label for="infile_type3">
					<input type="radio" id="infile_type3" name="infile_type" value="infer" checked>
					Infer
				</label>
			</fieldset>

			<fieldset>
				<legend>Software</legend>

				<label for="software1">
					<input type="radio" id="software1" name="software" value="pd" required>
					Proteome Discoverer
				</label>

				<label for="software2">
					<input type="radio" id="software2" name="software" value="sm" >
					SpectroMine
				</label>

				<label for="software3">
					<input type="radio" id="software3" name="software" value="infer" checked>
					Infer
				</label>
			</fieldset>

			<fieldset>
				<legend>Condition file</legend>
					<input type=file name=condfile>
					<p>Note: TMT channels only.</p>
			</fieldset>

			<fieldset>
				<legend>Protease MEROPS file</legend>
					<input type=file name=protfile>
					<p>Protease MEROPS identifiers to predict the presence of using weighted PSSM.</p>
			</fieldset>
		
		</section>

		<section>
			
		<h3>Prossesing</h3>

			<fieldset>
				<legend>Filtering</legend>

				<label for="filter1">
					<input type="radio" id="filter1" name="filter" value="all" required checked>
					No filter
				</label>

				<label for="filter2">
					<input type="radio" id="filter2" name="filter" value="nterm">
					N termini
				</label>

				<label for="filter3">
					<input type="radio" id="filter3" name="filter" value="quant">
					TMT N termini
				</label>
			</fieldset>

			<fieldset>
				<legend>Statistics (only with condition file)</legend>
				<ul>
					<li>	
						<label for="statistics">
							<input type="checkbox" id="statistics" name="statistics" value=True>
							Perform statistical testing
						</label>
					</li>

					<li>	
						<label for="stat_pairwise">
							<input type="checkbox" id="stat_pairwise" name="stat_pairwise" value=True>
							Perform pairwise t-testing instead of ANOVA if conditions > 3
						</label>
					</li>

					<li>
						<p>Fold distribution check</p>
						<label for="significance1">
							<input type="radio" id="significance1" name="significance" value="all">
							No distinction
						</label>
						<label for="significance2">
							<input type="radio" id="significance2" name="significance" value="nterm">
							Natural - neo nterm
						</label>
					</li>
				</ul>
			</fieldset>

			<fieldset>
				<legend>Miscellaneous</legend>
				<ul>
					<li>	
						<label for="dropna">
							<input type="checkbox" id="dropna" name="dropna" value=True>
							<span title="Removes any empty/missing quantification value rows in the dataset. No values in any quantification channel must be present in order for the column to be discarded.">Drop rows not containing any quantification values (NaN)</span>
						</label>
					</li>

					<li>	
						<label for="singlecpu">
							<input type="checkbox" id="singlecpu" name="singlecpu" value=True>
							<span title="Only check if you know what you're doing. In most cases it would result to a significant performance decrease.">Use single core instead of concurrent processes</span>
						</label>
					</li>

					<li>	
						<label for="nomerops">
							<input type="checkbox" id="nomerops" name="nomerops" value=True>
							<span title="MEROPS annotation queries static MEROPS database cleavage annotation files and matches known cleavage sites and the proteases responsible for them to the dataset peptides. Check if you would like to turn off this feature.">Do not use MEROPS database annotation</span>
						</label>
					</li>

					<li>	
						<label for="noexopeptidase">
							<input type="checkbox" id="noexopeptidase" name="noexopeptidase" value=True>
							<span title="The exopeptidase activity feature examines the peptides in the dataset for rugged patterns that would indicate endopeptidase or aminopeptidase activity and creates and annotation attribute. Check if you would like to turn off this feature.">Do not use exopeptidase activity check</span>
						</label>
					</li>

					<li>
						<label for="sleeptime">
							<input type="number" id="sleeptime" name="sleeptime" step="0.1" min=0 max=1 value=0.2>
							<span title="This is the cpu sleeptime between Uniprot batch requests. Please keep at a number above 0 unless you really need the results urgently.">Sleeptime (between requests)</span>
						</label>
					</li>
				</ul>
			</fieldset>
		
		</section>

		<section>
			
		<h3>Output</h3>

			<fieldset>
				<legend>Output format</legend>

				<label for="outfile_type1">
					<input type="radio" id="outfile_type1" name="outfile_type" value="csv" required>
					Csv
				</label>

				<label for="outfile_type2">
					<input type="radio" id="outfile_type2" name="outfile_type" value="xlsx" checked>
					Excel
				</label>

				<label for="outfile_type3">
					<input type="radio" id="outfile_type3" name="outfile_type" value="json">
					Json
				</label>

				<label for="outfile_type4">
					<input type="radio" id="outfile_type4" name="outfile_type" value="tsv" >
					Tsv
				</label>
			</fieldset>

			<fieldset>
				<legend>Visualize</legend>
				<label for="visualize">
					<input type=checkbox id="visualize" name=visualize value=True>
				Visualize dataset with various plots
				</label><br>

				<label for="enrichment">
					<input type=checkbox id="enrichment" name=enrichment value=True>
				Based on conditions, test for enrichment of GO terms and KEGG pathways with the gProfiler API
				</label><br>

				<label for="pathway">
					<input type=checkbox id="pathway" name=pathway value=True>
				Draws pathway plots based on conditions and maps detected proteins and peptides
				</label>			
			</fieldset>

			<fieldset>
				<legend>Calculate structure properties</legend>
				<p>Annotate cleavage site solvent accessibility and secondary structure for the significant peptides in the dataset using Pymol and Alphafold models.</p>

				<label for="calcstructure1">
					<input type="radio" id="calcstructure1" name="calcstructure" value="None" required checked>
					None
				</label>

				<label for="calcstructure2">
					<input type="radio" id="calcstructure2" name="calcstructure" value="significant">
					Significant
				</label>

				<label for="calcstructure3">
					<input type="radio" id="calcstructure3" name="calcstructure" value="all">
					All
				</label>
			</fieldset>

			<fieldset>
				<legend>Cleavage visualization</legend>
				<p>Chose whether to visualize significant cleavages in sequence alone or both in a 3D protein structure and sequence.</p>

				<label for="cleavagevis1">
					<input type="radio" id="cleavagevis1" name="cleavagevis" value="None" required checked>
					None
				</label>

				<label for="cleavagevis2">
					<input type="radio" id="cleavagevis2" name="cleavagevis" value="seq">
					Sequence only
				</label>

				<label for="cleavagevis3">
					<input type="radio" id="cleavagevis3" name="cleavagevis" value="both">
					Both
				</label>
			</fieldset>

			<fieldset>
				<legend>Sequence logo</legend>

				<label for="logo1">
					<input type="radio" id="logo1" name="logo" value="prob">
					Probability
				</label>

				<label for="logo2">
					<input type="radio" id="logo2" name="logo" value="shannon">
					Shannon
				</label>

				<label for="logo3">
					<input type="radio" id="logo3" name="logo" value="kbl">
					Kullback-Leibler
				</label>

				<label for="logo4">
					<input type="radio" id="logo4" name="logo" value="pssm" >
					PSSM
				</label>

				<label for="logo5">
					<input type="radio" id="logo5" name="logo" value="all" >
					All
				</label>
				<ul>
				<li>	
					<label for="pseudocounts">
						<input type="checkbox" id="pseudocounts" name="pseudocounts" value=True>
						Use pseudocounts in logo generation
					</label>
				</li>
				</ul>
			</fieldset>

			<fieldset>
				<legend>Output name</legend>
					<input type=text name=outfile_name>
				<p>Note: Insert only the desired output folder/file name, without any file extension.</p>
			</fieldset>

			<fieldset>
				<legend>Isolate</legend>
				<label for="separate">
					<input type=checkbox id="separate" name=separate value=True>
				Keep annotation separate from input; do not merge tables
				</label>
			</fieldset>

			<fieldset>
				<legend>User email</legend>
					<input type=text name=email>
				<p>Note: Your email will be used solely for the purpose of notifying of the results, and will not be stored.</p>
			</fieldset>

		</section>

		<section>
            <p> <button type="submit">Submit</button> </p>
        </section>

	</form>

	<hr/>

</body>
